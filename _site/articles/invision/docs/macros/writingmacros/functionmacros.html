<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Function Macros | Profitbase Docs </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Function Macros | Profitbase Docs ">
      
      <link rel="icon" href="../../../../../images/favicon.ico">
      <link rel="stylesheet" href="../../../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../../../public/main.css">
      <meta name="docfx:navrel" content="../../../../../toc.html">
      <meta name="docfx:tocrel" content="../../../../../toc.html">
      
      <meta name="docfx:rel" content="../../../../../">
      
      
      
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
  </head>

  <script type="module">
    import options from './../../../../../public/main.js'
    import { init } from './../../../../../public/docfx.min.js'
    init(options)
  </script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../../../index.html">
            <img id="logo" class="svg" src="../../../../../images/logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h3 id="function-macros">Function macros</h3>

<p>Function macros have the following characteristics:</p>
<ul>
<li><p>They <strong>must</strong> be implemented as methods in a class that inherits from the MacroExpansionProvider base class</p>
</li>
<li><p>They <strong>must</strong> return a string or a Taskm <em>&lt; string &gt;</em></p>
</li>
<li><p>They can have 0 or n parameters</p>
</li>
<li><p>They <strong>must</strong> be used on the form {{Macro()}} – <strong>Note the open an closing parenthesis ()</strong></p>
</li>
</ul>
<p><br> Because a Function macro can accept arguments, you can use it multiple places in the same query by providing different arguments to produce different expansions.
<br><br></p>
<blockquote>
<p><strong>Example</strong></p>
<p>This example shows how to create a function macro which takes one argument.<br>
You can use it in a SQL query like this:</p>
</blockquote>
<pre><code>SELECT {{MyRowCount(30}} … which will produce SELECT TOP 30 …
</code></pre>
<blockquote>
</blockquote>
<pre><code>    namespace Local
    {
        using System; 
        using System.Collections.Generic;
        using System.Threading.Tasks;
        using Profitbase.Invision.Scripting.Dynamic;
        public class MyMacros : MacroExpansionProvider
        {                
            public string MyRowCount(int num)
            {
                return $&quot;TOP {num}&quot;;
            }
        }
    }
</code></pre>
<br>
<h3 id="non-function-macros">Non-function macros</h3>
<p>Non-function macros have the following characteristics:</p>
<ul>
<li><p>They must be resolved in the RunAsync override method of a class that inherits from the MacroExpansionProvider base class</p>
</li>
<li><p>The RunAsync method returns a collection of <strong>Expansion</strong> objects. An Expansion object must contain the macro name and the expansion itself (the value that the macro produces)</p>
</li>
</ul>
<p><br> Because Non-Function macros cannot accept arguments, they will always produce the same result, so you cannot use them multiple places in the same query unless you want the same SQL expression to be inserted at the different locations.
<br>
<br></p>
<blockquote>
<p><strong>Example</strong></p>
<p>This example shows how to produce the expansions Non-function macros. Non-function macros cannot take any arguments, and they will always produce the same value for the same execution.</p>
</blockquote>
<pre><code>    namespace Local
    {
        using System; 
        using System.Collections.Generic;
        using System.Threading.Tasks;
        using Profitbase.Invision.Scripting.Dynamic;
        public class MacroRuntime : MacroExpansionProvider
        {
            public override async Task&lt;IEnumerable&lt;Expansion&gt;&gt; RunAsync()
            {
                var list = new List&lt;Expansion&gt;();
                list.Add(new Expansion(&quot;WhereClause&quot;, &quot;Qty &gt; 2&quot;));  
                // Expansion of the WhereClause macro 
                var columnNames = await ObjectModel.ForObject(&quot;WebApp Basic Store&quot;)  
                .Storage().GetColumnNamesAsync();
                list.Add(new Expansion(&quot;ColumnNames&quot;, string.Join(&quot;,&quot;, columnNames))); 
                 // Expansion of the ColumnNames macro
                return list; 
            }  
        }
    }
</code></pre>
</article>

        <div class="contribution d-print-none">
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>
        
      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>