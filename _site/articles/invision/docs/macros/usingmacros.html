<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Using Macros in SQL Statements | Profitbase Docs </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Using Macros in SQL Statements | Profitbase Docs ">
      
      <link rel="icon" href="../../../../images/favicon.ico">
      <link rel="stylesheet" href="../../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../../public/main.css">
      <meta name="docfx:navrel" content="../../../../toc.html">
      <meta name="docfx:tocrel" content="../../../../toc.html">
      
      <meta name="docfx:rel" content="../../../../">
      
      
      
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
  </head>

  <script type="module">
    import options from './../../../../public/main.js'
    import { init } from './../../../../public/docfx.min.js'
    init(options)
  </script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../../index.html">
            <img id="logo" class="svg" src="../../../../images/logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">


<p>You can put macros into any part of a SQL Script or Report query. Macros are not constraind to any particular part of SQL queries, for example WHERE clauses. You can even define your entire SQL query using just macros.</p>
<p>To add a macro to a SQL query, use the <strong>{{ and }}</strong> tokens to indicate the beginning and end of a macro, for example **{{MyWhereClause(@ProductID)}}**, where <strong>MyWhereClause</strong> is a macro that takes one argument.
<br></p>
<blockquote>
<p>The example below shows how to dynamically construct a SQL query using macros. As you can see, we’re using both Function and Non-Function macros (macros that can take arguments, and those that can’t).</p>
</blockquote>
<pre><code>SELECT {{ColumnNames}} 
FROM @Object[WebApp Basic Store,DataStore].DbObjectName 
WHERE {{WhereClause}} AND {{FilterOnQuantity(10)}} 
{{OrderByAsync()}}
</code></pre>
<br>
<p>There are 4 macros here – <strong>ColumnNames</strong>, <strong>WhereClause</strong>, <strong>FilterOnQuantity</strong> and <strong>OrderByAsync</strong>. ColumnNames and WhereClause are Non-Function macros (they do not have a parameter list), while FilterOnQuantity and OrderByAsync are function macros (they do have a parameter list). Non-function and Function macros does not differ in where they can be used, but how they can be used and how they are implemented.</p>
<blockquote>
<p>The code below shows the core concepts of how these macros can be implemented.<br>
Notice how the method names of the Function macros match the names of macros in the SQL expression and that they return a string.<br>
Also, regard that the expansions for the Non-Function macros are resolved in the <strong>RunAsync</strong> method.</p>
</blockquote>
<pre><code>namespace Local
{
    using System; 
    using System.Collections.Generic;
    using System.Threading.Tasks;
    using Profitbase.Invision.Scripting.Dynamic;
</code></pre>
<blockquote>
<pre><code>   public class MacroRuntime : MacroExpansionProvider
</code></pre>
</blockquote>
<pre><code>    {
        public override async Task&lt;IEnumerable&lt;Expansion&gt;&gt; RunAsync()
        {
            var list = new List&lt;Expansion&gt;();
            list.Add(new Expansion(&quot;WhereClause&quot;, &quot;Qty &gt; 2&quot;));  
            // Expansion of the WhereClause macro
</code></pre>
<blockquote>
</blockquote>
<pre><code>            var columnNames = await ObjectModel.ForObject(&quot;WebApp  
            Basic Store&quot;).Storage().GetColumnNamesAsync();
</code></pre>
<blockquote>
</blockquote>
<pre><code>            list.Add(new Expansion(&quot;ColumnNames&quot;, string.Join(&quot;,&quot;, columnNames)));  
            // Expansion of the ColumnNames macro
            return list; 
        }
</code></pre>
<blockquote>
<pre><code>       // Expansion of the FilterOnQuery macro
</code></pre>
</blockquote>
<pre><code>        public string FilterOnQuantity(int num)
        {
            return $&quot;Qty &lt; {num}&quot;; 
        }
</code></pre>
<blockquote>
<pre><code>       // Expansion of the OrderByAsync macro
</code></pre>
</blockquote>
<pre><code>        public Task&lt;string&gt; OrderByAsync()
        {
            return Task.FromResult(&quot;ORDER BY AccountID&quot;);
        }
    }
}
</code></pre>
</article>


        <div class="next-article d-print-none border-top" id="nextArticle"></div>
        
      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>