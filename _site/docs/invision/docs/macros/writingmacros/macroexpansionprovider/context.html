<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Context | Profitbase Docs </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Context | Profitbase Docs ">
      
      <link rel="icon" href="../../../../../../images/favicon.ico">
      <link rel="stylesheet" href="../../../../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../../../../public/main.css">
      <meta name="docfx:navrel" content="">
      <meta name="docfx:tocrel" content="../../../../toc.html">
      
      <meta name="docfx:rel" content="../../../../../../">
      
      
      
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
  </head>

  <script type="module">
    import options from './../../../../../../public/main.js'
    import { init } from './../../../../../../public/docfx.min.js'
    init(options)
  </script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../../../../index.html">
            <img id="logo" class="svg" src="../../../../../../images/logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">

<h4 id="context">Context</h4>
<h3 id="macroexpansionprovidercontext">MacroExpansionProvider.Context</h3>
<p>The Context API provides information about the current execution context of the macros. For example, for macros in a SQL Script, the current execution context of the macros is the invocation of the SQL Script.</p>
<p>The <strong>Context</strong> has the following APIs
<br></p>
<p><strong>Properties:</strong></p>
<p><code>ObjectId : string</code></p>
<blockquote>
<p>The Id of the object in the current execution context, for example the Object Id of a SQL Script or Report.</p>
</blockquote>
<p><code>SolutionId : string</code></p>
<blockquote>
<p>The ID of the solution in the current execution context, for example the id of the solution of the SQL Script being executed.</p>
</blockquote>
<p><code>IsDevMode : boolean</code></p>
<blockquote>
<p>Indicates whether the execution context is being invoked from the Designer or not.</p>
</blockquote>
<p><code>Arguments : ArgumentsProvider</code></p>
<blockquote>
<p>Provides access to read the arguments passed in to the execution context, for example the arguments passed by SetParamValue(…) when executing a SQL Script of loading data to a SQL Report.</p>
</blockquote>
<p><code>CustomArguments : ArgumentsList</code></p>
<blockquote>
<p>Provides an API for creating custom arguments from within macros. When generating parameterized SQL expressions, it is best practice to use query parameters instead of coding the values into the expressions. You can use the CustomArguments list to register query parameters from within your macro.</p>
</blockquote>
<p><code>UserId : string</code></p>
<blockquote>
<p>The id of the currently logged-in user, for example, user@corp.com.</p>
</blockquote>
<p><code>GetUserUniqueId() : string</code></p>
<blockquote>
<p>Returns the ID of the user account of the currently logged in user. If Azure AD is used as the identity provider, this is the OID (GUID) coming from Azure AD. If Windows AD is used, the ID is the SID.</p>
</blockquote>
<p><code>LanguageCode : string</code></p>
<blockquote>
<p>The culture name in the format languagecode2-country/regioncode2, for example, EN-US.</p>
</blockquote>
<div class="NOTE">
<h5>Note</h5>
<p>This property usually just returns a two-letter language code (for example EN), because InVision is usually set up to use two-letter cultures codes.</p>
</div>
<p><code>TwoLetterLanguageCode : string</code></p>
<blockquote>
<p>The ISO 639-1 two letter language code, for example, EN.</p>
</blockquote>
<br>
<p>The <strong>ArgumentsProvider</strong> has the following APIs</p>
<p><code>bool TryGetValue&lt;T&gt;(string name, out T value)</code></p>
<p><code>bool TryGetValue(string name, out object value)</code></p>
<p><code>T GetValue&lt;T&gt;(string name)</code></p>
<p><code>object GetValue(string name)</code></p>
<p><code>bool Contains(string name)</code></p>
<br>
<blockquote>
<p>The following example shows how the <strong>Context</strong> API can be used to create the ConditionalWhere macro.</p>
</blockquote>
<pre><code>namespace Local
{
    using System; 
    using System.Collections.Generic;
    using System.Threading.Tasks;
    using Profitbase.Invision.Scripting.Dynamic;
    public class MyMacros : MacroExpansionProvider
    {           
        public string ConditionalWhere(string tableAlias)
        {            
            if(this.Context.IsDevMode)
            {
                return &quot;WHERE 1 = 1&quot;;
            }
            else
            {
                if(this.Context.Arguments.TryGetValue&lt;int&gt;(&quot;@Level&quot;, out int level))
                {
                    // @SelectedProductId is passed as argument to the execution context
                    // for example by SetParamValue(...). 
                    // If it is not, provide a default value
                    if(!this.Context.Arguments.Contains(&quot;@SelectedProductId&quot;))
                    {
                       this.Context.CustomArguments.Add(&quot;@SelectedProductId&quot;, &quot;myDummyValue&quot;);
                    }
                    switch(level)
                    {
                        case 1:
                            return $&quot;WHERE {tableAlias}.L1 = @SelectedProductId&quot;;
                        case 2:
                            return $&quot;WHERE {tableAlias}.L2 = @SelectedProductId&quot;;
                        default:
                            return $&quot;WHERE {tableAlias}.LEAF = @SelectedProductId&quot;;
                    }
                }
                else
                {
                    return &quot;WHERE 1 = 2&quot;; 
                }
            }
        }
    }
}
</code></pre>
<br>
</article>


        <div class="next-article d-print-none border-top" id="nextArticle"></div>
        
      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>